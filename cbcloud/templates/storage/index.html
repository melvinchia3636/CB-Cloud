{% extends 'base/base.html' %}
{% load operations %}
{% load static %}

{% block breadcrumb %}{% endblock %}

{% block content %}
<div class="absolute left-6 bottom-6 w-3/12 messages" style="z-index:9999">
	{% for message in messages %}
	<div class="bg-indigo-400 text-white font-medium text-xl py-4 px-5 rounded-lg shadow-md">{{ message }}</div>
	{% endfor %}
</div>
<div class="flex items-center justify-between mt-12 text-indigo-400 font-bold text-3xl">
	<div class="flex items-center">
		<span class="iconify w-10 h-10 mr-4" data-icon="uil:hdd"></span>
		File Storage
	</div>
	<div class="flex gap-8">
		<div class="gap-8 hidden" id="func-tools">
			<button><span class="iconify w-7 h-7 text-gray-700" data-icon="uil:link-h"></span></button>
			<button><span class="iconify w-7 h-7 text-gray-700" data-icon="uil:unlock-alt"></span></button>
			<button onclick="downloadFile()"><span class="iconify w-7 h-7 text-gray-700" data-icon="uil:cloud-download"></span></button>
			<button onclick="removeFile()"><span class="iconify w-7 h-7 text-gray-700" data-icon="uil:trash-alt"></span></button>
			<button><span class="iconify w-7 h-7 text-gray-700" data-icon="uil:ellipsis-v"></span></button>
		</div>
		<div class="divider-v bg-gray-300 hidden"></div>
		<div class="flex gap-8">
			<button><span class="iconify w-7 h-7 text-gray-700" data-icon="tabler:layout-grid"></span></button>
			<button><span class="iconify w-7 h-7 text-gray-700" data-icon="uil:info-circle"></span></button>
		</div>
	</div>
</div>
<div class="text-left text-gray-500 font-semibold border-b-2 border-gray-200 mt-6 flex w-full">
	<p class="w-5/12 py-2">Name</p>
	<p class="w-2/12">Last Modified</p>
	<p class="w-2/12">Date Created</p>
	<p class="w-1/12">Size</p>
	<p class="w-2/12">Tags</p>
</div>
<div class="h-full overflow-y-hidden mt-0.5 tab relative">
	<div class="w-full table">
		{% for file in files %}
		<div class="border-b-2 bg-gray-100 transition-colors border-gray-200 font-medium text-lg file-row dropzone draggable-dropzone--occupied">
			<div class="flex items-center transition-colors item" onclick="goto(this, {{ forloop.counter }})" data-type="{{ file.type }}" data-path="{% ifequal file.type "folder" %}{{file.name}}{% else %}{{file.path}}{% endifequal %}">
				<div class="flex items-center w-full">
					<p class="w-5/12 py-3 font-semibold text-xl flex items-center pl-2 pr-4 whitespace-nowrap">
						<span class="iconify w-8 h-8 mr-4 text-indigo-400" data-icon="{% ifequal file.type 'folder' %}bx:bxs-folder{% else %}{% if file.icon %}{{file.icon}}{% else %}bi:file-earmark-fill{% endif %}{% endifequal %}"></span>
						<span class="overflow-ellipsis overflow-hidden" style="max-width: 20rem">{{file.name}}</span>
					</p>
					<p class="w-2/12">{{file.last_mod}}</p>
					<p class="w-2/12">{{file.created}}</p>
					<p class="w-1/12">{% ifequal file.type "file" %}{%fetchshort file.size %}{% else %}-{% endifequal %}</p>
					<p class="w-2/12"></p>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
</div>
<div class="fixed right-6 bottom-6 add">
	<button class="transition-all rounded-full w-16 h-16 shadow-md flex items-center justify-center bg-indigo-400" style="z-index: 9999">
		<span class="iconify w-7 h-7 text-white" data-icon="uil:plus" style="stroke: white; stroke-width: .6px"></span>
	</button>
	<div class="w-96 h-0 absolute bottom-0 right-0 text-gray-500 bg-white rounded-xl shadow-md overflow-hidden">
		<button class="w-full px-8 py-3 pt-3 flex items-center mb-3 gap-4 font-bold text-xl" onclick="newFolderPromptShow()">
			<span class="iconify w-8 h-8" data-icon="uil:folder-plus"></span>
			Create folder
		</button>
		<button class="w-full px-8 py-3 mt-3 flex items-center gap-4 font-bold text-xl" onclick="uploadFile()">
			<span class="iconify w-8 h-8" data-icon="uil:file-upload"></span>
			Upload file
		</button>
	</div>
</div>
<div id="folder-create" class="bg-trans transition-all duration-300 delay-200 w-full h-screen fixed top-0 left-0 flex items-center justify-center invisible">
	<div class="bg-white p-6 rounded-xl shadow-xl">
		<div class="flex items-center text-indigo-400 font-bold text-2xl">
			<span class="iconify w-8 h-8 mr-3" data-icon="uil:folder-plus"></span>
			New Folder
		</div>
		<form>
			<input type="text" class="text-gray-700 border-2 rounded-md border-gray-400 px-4 py-3 w-96 my-6 text-xl font-medium" placeholder="Untitled Folder"/>
			<div class="flex gap-2 justify-end w-full">
				<a class="font-semibold text-lg text-gray-500 px-5 py-2 rounded-md" onclick="newFolderPromptHide()">
					Cancel
				</a>
				<input type="submit" class="bg-indigo-400 font-semibold text-lg text-white px-6 py-2 rounded-md" value="Create">
			</div>
		</form>
	</div>
</div>
<div id="download-file" class="bg-trans transition-all duration-300 w-full h-screen fixed top-0 left-0 flex items-center justify-center invisible">
	<div class="bg-white p-6 rounded-xl shadow-xl">
		<div class="flex items-center text-indigo-400 font-bold text-2xl mb-4">
			<span class="iconify w-8 h-8 mr-3" data-icon="uil:cloud-download"></span>
			Download File
		</div>
		<div class="flex justify-between w-full items-center">
			<p class="font-bold text-lg"></p>
			<p class="font-bold text-lg indicator">0%</p>
		</div>
		<div class="bg-indigo-300 h-3 w-96 mb-6 rounded-full mt-1 overflow-hidden slider">
			
		</div>
		<a class="font-semibold text-lg text-center block w-full bg-indigo-400 text-white px-5 py-2 rounded-md" onclick="cancelDownload()">
			Cancel
		</a>
	</div>
</div>
<input type="file" id="upload" style="display: none" multiple/>
<script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.12/lib/draggable.bundle.js"></script>
<script>
	var HTMLParser = new DOMParser()
	var csrfToken = HTMLParser.parseFromString(`{% csrf_token %}`, "text/html").querySelector("input").value
</script>
<script src="{% static 'storage/storage.js' %}"></script>
{% endblock %}