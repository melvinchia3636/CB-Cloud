{% extends 'base/base.html' %}
{% load operations %}

{% block breadcrumb %}{% endblock %}

{% block content %}
<div class="flex items-center justify-between mt-12 text-indigo-400 font-bold text-3xl">
	<div class="flex items-center">
		<span class="iconify w-10 h-10 mr-4" data-icon="uil:hdd"></span>
		File Storage
	</div>
	<div class="flex gap-8">
		<button><span class="iconify w-8 h-8 text-gray-700" data-icon="tabler:layout-grid"></span></button>
		<button><span class="iconify w-8 h-8 text-gray-700" data-icon="uil:info-circle"></span></button>
	</div>
</div>
<table class="w-full mt-6" align="left">
	<tr class="text-left text-gray-500 border-b-2 border-gray-200">
		<th class="w-4/12 py-3">Name</th>
		<th class="w-2/12">Last Modified</th>
		<th class="w-2/12">Date Created</th>
		<th class="w-1/12">Size</th>
		<th class="w-2/12">Tags</th>
	</tr>
	{% for file in files %}
	<tr class="border-b-2 border-gray-200 font-medium text-lg file-row relative" {% ifequal file.type "folder" %}onclick="goto('{{file.name}}')"{% endifequal %}>
		<td class="py-3 font-semibold text-xl flex items-center pl-2 pr-4 whitespace-nowrap">
			<span class="iconify w-8 h-8 mr-4 text-indigo-400" data-icon="bx:bxs-{{file.type}}"></span>
			<span class="overflow-ellipsis overflow-hidden" style="max-width: 20rem">{{file.name}}</span>
		</td>
		<td>{{file.last_mod}}</td>
		<td>{{file.created}}</td>
		<td>{% ifequal file.type "file" %}{%fetchshort file.size %}{% else %}-{% endifequal %}</td>
		<td></td>
	</tr>
	{% endfor %}
</table>
<div class="fixed right-6 bottom-6 add">
	<button class="transition-all rounded-full w-16 h-16 shadow-md flex items-center justify-center bg-indigo-400">
		<span class="iconify w-7 h-7 text-white" data-icon="uil:plus" style="stroke: white; stroke-width: .6px"></span>
	</button>
	<div class="w-96 h-0 absolute bottom-0 right-0 text-gray-500 bg-white rounded-xl shadow-md overflow-hidden">
		<button class="w-full px-8 py-3 pt-3 flex items-center mb-3 gap-4 font-bold text-xl" onclick="newFolderPromptToggle()">
			<span class="iconify w-8 h-8" data-icon="uil:folder-plus"></span>
			Create folder
		</button>
		<div class="bg-gray-300 divider"></div>
		<button class="w-full px-8 py-3 mt-3 flex items-center gap-4 font-bold text-xl">
			<span class="iconify w-8 h-8" data-icon="uil:file-upload"></span>
			Upload file
		</button>
		<button class="w-full px-8 py-3 flex items-center gap-4 font-bold text-xl">
			<span class="iconify w-8 h-8" data-icon="uil:folder-upload"></span>
			Upload folder
		</button>
	</div>
</div>
<div id="folder-create" class="bg-trans transition-all duration-300 delay-200 w-full h-screen fixed top-0 left-0 flex items-center justify-center invisible">
	<div class="bg-white p-6 rounded-xl shadow-xl">
		<div class="flex items-center text-indigo-400 font-bold text-2xl">
			<span class="iconify w-8 h-8 mr-3" data-icon="uil:folder-plus"></span>
			New Folder
		</div>
		<input type="text" class="text-gray-700 border-2 rounded-md border-gray-400 px-4 py-3 w-96 my-6 text-xl font-medium" placeholder="Untitled Folder"/>
		<div class="flex gap-2 justify-end w-full">
			<button class="font-semibold text-lg text-gray-500 px-5 py-2 rounded-md" onclick="newFolderPromptToggle()">
				Cancel
			</button>
			<button class="bg-indigo-400 font-semibold text-lg text-white px-6 py-2 rounded-md">
				Create
			</button>
		</div>
	</div>
</div>
{% endblock %}

{% block script %}
const goto = path => window.location += (!(window.location.href[window.location.href.length-1] === "/") ? "/" : "") + path

const arrow = `<svg class="mt-0.5" width="10" height="10" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M3.375 7.5L6.375 4.5L3.375 1.5" stroke="#5E78FF" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`
paths = window.location.pathname.split('/').filter(e => e).map(e => decodeURI(e))
$('#breadcrumb').append(paths.slice(0, paths.length-1).join(arrow))
$('#breadcrumb').append(`${paths.length > 1 ? arrow : ""}<span class='font-bold'>${paths[paths.length-1]}</span>`)

const newFolderPromptToggle = () => {
		$("#folder-create").toggleClass("invisible").toggleClass('black-op-bg')
		$(".add > div").toggleClass('show');
}

$(".add > button").click(() => {
	$(".add > div").addClass('show')
})

$('body').on('click', function (e) {
	if (!$(".add *").is(e.target) && $(".add > div").has(e.target).length === 0 && $(".add > div").is(":visible")) {
		$(".add > div").removeClass('show');
	}
});
{% endblock %}